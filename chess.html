
<html>
    <head>
        <link rel="stylesheet" href="styles.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

    </head>

    <body>
        <div class="main">
            <div class="side" id="left">
                <!-- <h2>AI</h2>
                <input type="checkbox" id="myCheck" onclick="aichange()">
                -->
            </div>
        <div class="holder" id="holder">     
        </div>
        <div class="side" id="right">
            <h1 id="b"></h1>
            <h1 id="w"></h1>
        </div>
    </div>
    <script>
        let rook63Moved = false;
        let king60Moved = false;
        let rook56Moved = false;
        let rook7Moved = false;
        let rook0Moved = false;
        let king4Moved = false;
        let prevMove;
        let bCheck = false;
        let wCheck = false;
        let castled = false;
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        let ai;
        let sm;
        let mo;
        if(urlParams.get('ai') === "true"){
            ai = true;
        }
        else{
            ai = false;
        }
    if(urlParams.get('sm') === "true"){
        sm = true;
    }
    else{
        sm = false;
    }
    if(urlParams.get('mo') === "true"){
        mo = true;
    }
    else{
        mo = false;
    }
        let chessGrid = [[['w', 0, 'br', []], ['b', 1, 'bk', []], ['w', 2, 'bb', []], ['b', 3, 'bq', []], ['w', 4, 'bki', []], ['b', 5, 'bb', []], ['w', 6, 'bk', []], ['b', 7, 'br', []]],
                         [['b', 8, 'bp', []], ['w', 9, 'bp', []], ['b', 10, 'bp', []], ['w', 11, 'bp', []], ['b', 12, 'bp', []], ['w', 13, 'bp'], ['b', 14, 'bp', []], ['w', 15, 'bp', []]],
                         [['w', 16, '', []], ['b', 17, '', []], ['w', 18, '', []], ['b', 19, '', []], ['w', 20, '', []], ['b', 21, '', []], ['w', 22, '', []], ['b', 23, '', []]],
                         [['b', 24, '', []], ['w', 25, '', []], ['b', 26, '', []], ['w', 27, '', []], ['b', 28, '', []], ['w', 29, '', []], ['b', 30, '', []], ['w', 31, '', []]],
                         [['w', 32, '', []], ['b', 33, '', []], ['w', 34, '', []], ['b', 35, '', []], ['w', 36, '', []], ['b', 37, '', []], ['w', 38, '', []], ['b', 39, '', []]],
                         [['b', 40, '', []], ['w', 41, '', []], ['b', 42, '', []], ['w', 43, '', []], ['b', 44, '', []], ['w', 45, '', []], ['b', 46, '', []], ['w', 47, '', []]],
                         [['w', 48, 'wp', []], ['b', 49, 'wp', []], ['w', 50, 'wp', []], ['b', 51, 'wp', []], ['w', 52, 'wp', []], ['b', 53, 'wp', []], ['w', 54, 'wp'], ['b', 55, 'wp', []]],
                         [['b', 56, 'wr', []], ['w', 57, 'wk', []], ['b', 58, 'wb', []], ['w', 59, 'wq', []], ['b', 60, 'wki', []], ['w', 61, 'wb', []], ['b', 62, 'wk'], ['w', 63, 'wr', []]]]
        let gridNum = 64;
        let rowCount = 8;
        let whiteTurn = true;
        let iArray = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63];
        let dif = true;

        let nId = iArray[Math.floor(Math.random() * iArray.length)];
        while(dif){
        for(let i = 0; i < iArray.length; i++){
            if(iArray[i] === nId){
                if(i === 0){
                iArray.splice(0, 1);
               
                }
                else{
                    iArray.splice(i, i);
                }
                nId = iArray[Math.floor(Math.random() * iArray.length)];
            }
        }
        if(iArray.length === 0){
            dif = false;
         //   alert("0");
        }
       
    }
        createGrid();
        allLegalMoves(chessGrid);
       
       // alert(chessGrid[1][1][3][1]);
        function createGrid(){
            document.getElementById("holder").style.setProperty("--grid-count", rowCount);
            for(let i = 0; i < chessGrid.length; i++){
                for(let x = 0; x < chessGrid[i].length; x++){
                let box = document.createElement("div");
                if(chessGrid[i][x][0] === 'w'){
                    box.classList.add("box-white");
                    box.classList.add("box");
                   
                }
                else{
                    box.classList.add("box-black");
                    box.classList.add("box");   
                }
                var img = document.createElement("img");
                if(chessGrid[i][x][2] == 'wq'){     
                         img.src = "wq.png";
                         img.classList.add("chess");
                    }
                    else if(chessGrid[i][x][2] == 'wp'){
                         var img = document.createElement("img");
                         img.src =  "wp.png";
                         img.classList.add("chess_pawn");  
                    }
                    else if(chessGrid[i][x][2] == 'wki'){
                         var img = document.createElement("img");
                         img.src = "wki.png";
                         img.classList.add("chess");  
                    }
                    else if(chessGrid[i][x][2] == 'wb'){
                         var img = document.createElement("img");
                         img.src = "wb.png";
                         img.classList.add("chess");  
                    }
                    else if(chessGrid[i][x][2] == 'wk'){
                         var img = document.createElement("img");
                         img.src = "wk.png";
                         img.classList.add("chess_knight");  
                    }
                    else if(chessGrid[i][x][2] == 'wr'){
                         var img = document.createElement("img");
                         img.src = "wr.png";
                         img.classList.add("chess");  
                    }
                    else  if(chessGrid[i][x][2] == 'bq'){     
                         img.src = "bq.png";
                         img.classList.add("chess");
                    }
                    else if(chessGrid[i][x][2] == 'bp'){
                         var img = document.createElement("img");
                         img.src = "bp.png";
                         img.classList.add("chess");  
                    }
                    else if(chessGrid[i][x][2] == 'bki'){
                         var img = document.createElement("img");
                         img.src = "bki.png";
                         img.classList.add("chess");  
                    }
                    else if(chessGrid[i][x][2] == 'bb'){
                         var img = document.createElement("img");
                         img.src = "bb.png";
                         img.classList.add("chess_bishop");  
                    }
                    else if(chessGrid[i][x][2] == 'bk'){
                         var img = document.createElement("img");
                         img.src = "bk.png";
                         img.classList.add("chess_knight");  
                    }
                    else if(chessGrid[i][x][2] == 'br'){
                         var img = document.createElement("img");
                         img.src = "br.png";
                         img.classList.add("chess");  
                    }
                    if(img.src){
                    box.appendChild(img);
                    }
                    box.addEventListener("click", function(){
                    alertId(this.id);
                 });
                box.id = chessGrid[i][x][1];
                document.getElementById("holder").appendChild(box);
                }
            }
        }
        let prev = -1;
        let currPiece = '';
        function inCheck(color, grid, futureChecking){
            let check = false;
            if(color === 'w'){
                let kingId;
                for(let i = 0; i < grid.length; i++){
                for(let x = 0; x < grid[i].length; x++){
                    if(grid[i][x][2] === 'wki'){
                       kingId = grid[i][x][1];
                    }
                }
            }
                for(let i = 0; i < grid.length; i++){
                for(let x = 0; x < grid[i].length; x++){
                    if(grid[i][x][2].charAt(0) === 'b'){
                        if(checkLegalMove(grid[i][x][1], kingId, grid[i][x][2], grid, true, false)){
                            check = true;
                            wCheck = true;
                        }
                    }
                }
            }
           
        }
        else{
            let kingId;
                for(let i = 0; i < grid.length; i++){
                for(let x = 0; x < grid[i].length; x++){
                    if(grid[i][x][2] === 'bki'){
                       kingId = grid[i][x][1];
                    }
                }
            }
                for(let i = 0; i < grid.length; i++){
                for(let x = 0; x < grid[i].length; x++){
                    if(chessGrid[i][x][2].charAt(0) === 'w'){
                        if(checkLegalMove(grid[i][x][1], kingId, grid[i][x][2], grid, true, false)){
                            check = true;
                            bCheck = true;
                        }
                    }
                }
            }
          
        }
        return check;
    }
        function alertId(e){ 
           
            let piece;
                 for(let i = 0; i < chessGrid.length; i++){
                for(let x = 0; x < chessGrid[i].length; x++){
                    if(chessGrid[i][x][1] == parseInt(e)){
                        piece = chessGrid[i][x][2];
                    }
                }
            }   
            if(piece !== '' && prev < 0){
                document.getElementById(e).classList.remove("box-white");
                document.getElementById(e).classList.remove("box-black");
                document.getElementById(e).classList.add("box-selected");
                let color;
                if(prev > -1){
                    
                    for(let i = 0; i < chessGrid.length; i++){
                      for(let x = 0; x < chessGrid[i].length; x++){
                    if(chessGrid[i][x][1] == prev){
                        color = chessGrid[i][x][0];
                        currPiece = chessGrid[i][x][2];
                       // alert(currPiece);
                    }
                }
                
            }   
            document.getElementById(prev).classList.remove("box-selected");
                if(color === 'w'){
                    document.getElementById(prev).classList.add("box-white");
                   
                }
                else{
                    document.getElementById(prev).classList.add("box-black");
                    
                }
               
                prev = parseInt(e);
                }
                else{

                
                prev = parseInt(e);
                for(let i = 0; i < chessGrid.length; i++){
                      for(let x = 0; x < chessGrid[i].length; x++){
                    if(chessGrid[i][x][1] == prev){
                        currPiece = chessGrid[i][x][2];
                       // alert(currPiece);
                    }
                }
            }
            let idArray;
            for(let i = 0; i < chessGrid.length; i++){
                      for(let x = 0; x < chessGrid[i].length; x++){
                    if(chessGrid[i][x][1] === prev){
                      idArray = chessGrid[i][x][3];
                    }
                }
            }
            if(sm){
            for(let z = 0; z < idArray.length; z++){
                for(let i = 0; i < chessGrid.length; i++){
                      for(let x = 0; x < chessGrid[i].length; x++){
                    if(chessGrid[i][x][1] === idArray[z]){
                        if(chessGrid[i][x][0] === "w"){
                        document.getElementById(idArray[z]).classList.add("box-possible");
                        }
                        else{
                            document.getElementById(idArray[z]).classList.add("box-possibleB");
                        }
                        document.getElementById(idArray[z]).classList.remove("box");
                        document.getElementById(idArray[z]).classList.remove("box-black");
                        document.getElementById(idArray[z]).classList.remove("box-prev");
                      
                    }
                }
            }
            }
        }

                }
                
            }
            
            else{
               
                if(currPiece !== ''){
            if(parseInt(e) !== prev){
                    let move = false;
                if(whiteTurn){
                    if(currPiece.charAt(0) === 'w'){
                       move = true;
                    }
                }
                else{
                    if(currPiece.charAt(0) === 'b'){
                       move = true;
                       
                    }
                }
                if(move && checkLegalMove(prev, parseInt(e), currPiece, chessGrid, false, true)){
                
                 makeMove(prev, parseInt(e), currPiece);
                
               
                 if(currPiece === 'wr' && prev === 63){
                    rook63Moved = true;
                 }
                 if(currPiece === 'wr' && prev === 56){
                    rook56Moved = true;
                 }
                 if(currPiece === 'br' && prev === 7){
                    rook7Moved = true;
                 }
                 if(currPiece === 'br' && prev === 0){
                    rook0Moved = true;
                 }
                 if(currPiece === 'wki'){
                    king60Moved = true;
                 }
                 if(currPiece === 'bki'){
                    king4Moved = true;
                 }      
                 let z;
                 for(let i = 0; i < chessGrid.length; i++){
                      for(let x = 0; x < chessGrid[i].length; x++){
                        if(chessGrid[i][x][1] === parseInt(e)){
                            z = x;
                        }
                      }
                    }
                 prevMove = [prev, parseInt(e), currPiece, z];
                 allLegalMoves(chessGrid);
                 whiteTurn = !whiteTurn;
                    if(!whiteTurn){
                        if(ai){
                            setTimeout(() => {  makeRandomMove("b", chessGrid);   allLegalMoves(chessGrid);}, 250);  
                     
                        }
                    }
                    allLegalMoves(chessGrid);
                }
               
            }
                currPiece = '';
                let color;
                for(let i = 0; i < chessGrid.length; i++){
                      for(let x = 0; x < chessGrid[i].length; x++){
                    if(chessGrid[i][x][1] == prev){
                        color = chessGrid[i][x][0];
                       
                       // alert(currPiece);
                    }
                }
            }
            for(let i = 0; i < chessGrid.length; i++){
                      for(let x = 0; x < chessGrid[i].length; x++){
                        if(sm){
                        document.getElementById(chessGrid[i][x][1]).classList.remove("box-possible");
                        document.getElementById(chessGrid[i][x][1]).classList.remove("box-possibleB");
                        }
                         if(chessGrid[i][x][0] === 'w'){
                    document.getElementById(chessGrid[i][x][1]).classList.add("box-white");
                }
                else{
                    document.getElementById(chessGrid[i][x][1]).classList.add("box-black");
                }
                      }
                    }
                    
                document.getElementById(prev).classList.remove("box-selected");
                if(color === 'w'){
                    document.getElementById(prev).classList.add("box-white");
                }
                else{
                    document.getElementById(prev).classList.add("box-black");
                }
               
                prev = -1;
            }

            }
           
           
           
        }
       function checkLegalMove(prevId, newId, piece, grid, checking, wantToMove){
        
        let legal = true;
        let piece2 = '';
        let p = getPiece(piece);
        let c = piece.charAt(0);
        let white = false;
        let rN = 0;
        let rP = 0;
        let cN = 0;
        let cP = 0;
        let prevSquareColor = '';
        let newSquareColor = '';
        let iValue;
        let xValue;  
       
        for(let i = 0; i < grid.length; i++){
                      for(let x = 0; x < grid[i].length; x++){
                    if(grid[i][x][1] == newId){
                   
                       piece2 = grid[i][x][2];
                      
                       rN = i;
                       cN = x;
                       newSquareColor = grid[i][x][0];
                       // alert(currPiece);
                    }
                    else if(grid[i][x][1] == prevId){
                       
                        rP = i;
                        cP = x;
                        prevSquareColor = grid[i][x][0];
                        iValue = i;
                        xValue = x;
                    }
                }
            }
          if(wantToMove){
           // alert(cP + " " + cN);
          }
        if(c === 'w'){
            white = true;
        }
        let queenLegal1 = true;
        let queenLegal2 = true;
        if(p === 'pawn'){
            if(!white){
                
               if(prevId > newId){
               
                legal = false;
               }
               if((newId - prevId) % 8 !== 0){
                if(piece2 !== ''){
                    if(newId - prevId !== 7 && newId - prevId !== 9){
                        legal = false;
                    }
                    
                    if((cP === 0 && cN === 7) || (cN === 0 && cP === 7)){
                        
                        legal = false;
                    }
                }
                else{
                    legal = false;
                }
               
               }
               else{
                if(piece2 !== ''){
                   
                        legal = false;
                    
                }
               }
               if(prevId > 7 && prevId < 16){
                if(newId > 31){
                    
                    legal = false;
                }
                for(let i = 0; i < grid.length; i++){
                    for(let x = 0; x < grid[i].length; x++){
                        if(grid[i][x][1] === prevId + 8){
                            if(grid[i][x][2] !== ''){
                                legal = false;
                            }
                        }
                       
                    }
                }
                
               }
               if(prevId > 15){
                 if(newId - prevId !== 8){
                    if(piece2 !== ''){
                    if(newId - prevId !== 7 && newId - prevId !== 9){
                        
                        legal = false;
                    }
                    if((cP === 0 && cN === 7) || (cN === 0 && cP === 7)){
                        legal = false;
                    }
                }
                else{
                    legal = false;
                }
                 }
                 else{
                if(piece2 !== ''){
                   
                        legal = false;
                    
                }
               }
               }
               if(prevMove){
              if(prevMove[2] === 'wp'){
               
                if(prevMove[0] - prevMove[1] === 16){
                    
                    if(((prevId === prevMove[1] + 1) || prevId === prevMove[1] - 1) && Math.abs(cP - prevMove[3]) !== 7){
                      
                       if(newId === prevMove[1] + 8){
                       
                         legal = true;
                         if(wantToMove){
                         deletePiece(prevMove[1]);
                        }
                       }
                    }
                    
                }
                
              }
            }
              
            }
            else{
                if(prevId < newId){
                    legal = false;
                }
                if((prevId - newId) % 8 !== 0){
                    if(piece2 !== ''){
                    if(prevId - newId !== 7 && prevId - newId !== 9){
                        legal = false;
                    }
                    if((cP === 0 && cN === 7) || (cN === 0 && cP === 7)){
                        legal = false;
                    }
                }
                else{
                    legal = false;
                }
               
               }
               else{
                if(piece2 !== ''){
                   
                        legal = false;
                    
                }
               }
               if(prevId > 47 && prevId < 56){
                if(newId < 32){
                    legal = false;
                }
                for(let i = 0; i < grid.length; i++){
                    for(let x = 0; x < grid[i].length; x++){
                        if(grid[i][x][1] === prevId - 8){
                            if(grid[i][x][2] !== ''){
                                legal = false;
                            }
                            
                        }
                    }
                }
               }
               if(prevId < 47){
                if(prevId - newId !== 8){
                    if(piece2 !== ''){
                    if(prevId - newId !== 7 && prevId - newId !== 9){
                      
                        legal = false;
                    }
                }
                else{
                    legal = false;
                }
                 }
                 else{
                if(piece2 !== ''){
                   
                        legal = false;
                    
                }
               }
               }
               if(prevMove){
              if(prevMove[2] === 'bp'){
               
                if(prevMove[1] - prevMove[0] === 16){
                    if((prevId === prevMove[1] + 1 || prevId === prevMove[1] - 1) && Math.abs(cP - prevMove[3]) !== 7){
                       
                       
                        
                       if(newId === prevMove[1] - 8){
                        
                         legal = true;
                         if(wantToMove){
                         deletePiece(prevMove[1]);
                        }
                       
                       }
                    
                    }
                    
                }
              }
            }
            }
            if(cN === 7 && cP === 0){
                legal = false;
            }
        }
        else if(p === 'king'){
           
            if(newId !== prevId + 1 && newId !== prevId - 1 && newId - prevId !== 8 && newId - prevId !== -8 && newId - prevId !== 9 && newId - prevId !== 7 && prevId - newId !== 9 && prevId - newId !== 7){
              
                legal = false;
            }
            if(Math.abs(cN - cP) === 7){
                legal = false;
            }
            if(white){
                if(!wCheck){
            if(p === 'king' && piece2 === 'wr'){
                if(grid[rN][cN][1] === 63){   
                    if(grid[rN][cN - 1][2] === '' && grid[rN][cN - 2][2] === ''){
                        if(!king60Moved && !rook63Moved){
                            if(wantToMove){
                               
                        makeMove(60, 62, 'wki');
                        makeMove(63, 61, 'wr');
                        castled = true;
                            }
                            return true;
                        }
                    }
                }
            }
             if(p === 'king' && piece2 === 'wr'){
                if(grid[rN][cN][1] === 56){   
                    if(grid[rN][cN + 1][2] === '' && grid[rN][cN + 2][2] === '' && grid[rN][cN + 3][2] === ''){
                        if(!king60Moved && !rook56Moved){
                            if(wantToMove){
                        makeMove(60, 58, 'wki');
                        makeMove(56, 59, 'wr');
                        castled = true;
                            }
                            return true;
                        }
                    }
                }
            }
        }
            }
            else{
                if(!bCheck){
            if(p === 'king' && piece2 === 'br'){
                if(grid[rN][cN][1] === 7){   
                    if(grid[rN][cN - 1][2] === '' && grid[rN][cN - 2][2] === ''){
                        if(!king4Moved && !rook7Moved){
                            if(wantToMove){
                        makeMove(4, 6, 'bki');
                        makeMove(7, 5, 'br');
                        castled = true;
                            }
                            return true;
                        }
                    }
                }
            }
             if(p === 'king' && piece2 === 'br'){
                if(grid[rN][cN][1] === 0){   
                    if(grid[rN][cN + 1][2] === '' && grid[rN][cN + 2][2] === '' && grid[rN][cN + 3][2] === ''){
                        if(!king4Moved && !rook0Moved){
                            if(wantToMove){
                        makeMove(4, 2, 'bki');
                        makeMove(0, 3, 'br');
                        castled = true;
                            }
                             return true;
                        }
                    }
                }
            }
        }
            }
        }    
        if(p === 'rook' || p === 'queen'){
           
           if(rN !== rP && cN !== cP){
           if(p === 'queen'){
            queenLegal1 = false;
           }
           else{
            legal = false;
           }
           }
           let vertPieces = [];
           let horzPieces = [];
           
           for(let i = 0; i < grid.length; i++){
            
           
            if(grid[i][cP][2] !== piece){
                vertPieces.push([grid[i][cP][1], grid[i][cP][2]]);
            }
            if(grid[rP][i][2] !== piece){
                horzPieces.push([grid[rP][i][1], grid[rP][i][2]]);
            }
        }
            if(rN === rP){
               
                for(let i = 0; i < horzPieces.length; i++){
                    
                       if(horzPieces[i][1] !== ''){
                        if((horzPieces[i][0] < prevId && horzPieces[i][0] > newId) || (horzPieces[i][0] > prevId && horzPieces[i][0] < newId)){
                            if(p === 'queen'){
                                 queenLegal1 = false;
                             }
                          else{
                             legal = false;
                         }
                        } 
                       }
                    
                }
            }
            else{
                for(let i = 0; i < vertPieces.length; i++){
                    
                    if(vertPieces[i][1] !== ''){
                     if((vertPieces[i][0] < prevId && vertPieces[i][0] > newId) || (vertPieces[i][0] > prevId && vertPieces[i][0] < newId)){
                        if(p === 'queen'){
                             queenLegal1 = false;
                             }
                          else{
                         legal = false;
                          }
                     } 
                    }
                 
             }
            }
           

            if(white){
                if(!wCheck){
            if(p === 'rook' && piece2 === 'wki'){
                if(grid[rN][cN][1] === 60){   
                    if(grid[rN][cN + 1][2] === '' && grid[rN][cN + 2][2] === ''){
                        if(!king60Moved && !rook63Moved){
                            if(wantToMove){
                        makeMove(60, 62, 'wki');
                        makeMove(63, 61, 'wr');
                        castled = true;
                            }

                            return false;
                        }
                    }
                }
            }
             if(p === 'rook' && piece2 === 'wki'){
                if(grid[rN][cN][1] === 60){   
                    if(grid[rN][cN - 1][2] === '' && grid[rN][cN - 2][2] === '' && grid[rN][cN - 3][2] === ''){
                        if(!king60Moved && !rook56Moved){
                            if(wantToMove){
                        makeMove(60, 58, 'wki');
                        makeMove(56, 59, 'wr');
                        castled = true;
                            }
                            return false;
                        }
                    }
                }
            }
            }
        }
            else{
                if(!bCheck){
               if(p === 'rook' && piece2 === 'bki'){
                   if(grid[rN][cN][1] === 4){   
                       if(grid[rN][cN + 1][2] === '' && grid[rN][cN + 2][2] === ''){
                           if(!king4Moved && !rook7Moved){
                            if(wantToMove){
                           makeMove(4, 6, 'bki');
                           makeMove(7, 5, 'br');
                           castled = true;
                            }
                            return false;
                           }
                       }
                   }
               }
                if(p === 'rook' && piece2 === 'bki'){
                   if(grid[rN][cN][1] === 4){   
                       if(grid[rN][cN - 1][2] === '' && grid[rN][cN - 2][2] === '' && grid[rN][cN - 3][2] === ''){
                           if(!king4Moved && !rook0Moved){
                            if(wantToMove){
                           makeMove(4, 2, 'bki');
                           makeMove(0, 3, 'br');
                            castled = true;
                            }
                            return false;
                           }
                       }
                   }
               }
               
               }
            }
            
       }   
        if(p === 'bishop' || p === 'queen'){
            if(prevSquareColor !== newSquareColor){
                if(p === 'queen'){
                    queenLegal2 = false;
                    
             }
             else{
            legal = false;
           }
            }
            if(Math.abs(rN - rP) !== Math.abs(cN - cP)){
                
                if(p === 'queen'){
                    queenLegal2 = false;
             }
             else{
            legal = false;
           }
            }
            let pieceArray = [];
            if(rN > rP && cN > cP){
                let x  = cP;
                for(let i = rP; i < rN; i++){  
                        if(x < 8 && grid[i][x][2] !== ''){
                            
                            if(grid[i][x][1] > prevId && grid[i][x][1] < newId){
                                if(p === 'queen'){
                    queenLegal2 = false;
             }
             else{
            legal = false;
           }
                            }
                        }
                      x++;
                    }  
            }
            else if(rN < rP && cN > cP){
                let x  = cP;
                for(let i = rP; i > 0; i--){  
                        if(x < 8 && grid[i][x][2] !== ''){
                            
                            if(grid[i][x][1] < prevId && grid[i][x][1] > newId){
                                if(p === 'queen'){
                    queenLegal2 = false;
             }
             else{
            legal = false;
           }
                            }
                        }
                      x++;
                    }  
            }
            else if(rN < rP && cN < cP){
                let x  = cP;
                for(let i = rP; i > 0; i--){  
                        if(x > 0 && grid[i][x][2] !== ''){
                            
                            if(grid[i][x][1] < prevId && grid[i][x][1] > newId){
                                if(p === 'queen'){
                    queenLegal2 = false;
             }
             else{
            legal = false;
           }
                            }
                        }
                      x--;
                    }  
            }
            if(rN > rP && cN < cP){
                let x  = cP;
                for(let i = rP; i < rN; i++){  
                        if(x > 0 && grid[i][x][2] !== ''){
                            
                            if(grid[i][x][1] > prevId && grid[i][x][1] < newId){
                                if(p === 'queen'){
                    queenLegal2 = false;
             }
             else{
            legal = false;
           }
                            }
                        }
                      x--;
                    }  
            }
            
           
        }
        if(p === 'queen'){
            
            if(!queenLegal1 && !queenLegal2){
                legal = false;
            }
        }
        if(p === 'knight'){
            if((rN !== rP - 2 || cN !== cP + 1) && (rN !== rP - 2 || cN !== cP - 1) && (rN !== rP + 2 || cN !== cP -1) && (rN !== rP + 2 || cN !== cP + 1) && (rN !== rP - 1 || cN !== cP + 2) && (rN !== rP + 1 || cN !== cP - 2) && (rN !== rP + 1 || cN !== cP + 2) && (rN !== rP - 1 || cN !== cP - 2) && (rN !== rP - 1 || cN !== cP + 2)){
                legal = false;
            }
            
        }
       
        if(piece2 !== '' && piece2.charAt(0) === piece.charAt(0)){
                legal = false;
            }
       if(!checking && legal){
            if(futureCheck(prevId, newId, piece, chessGrid)){
            legal = false;
        } 
    }
   
            return legal;
       }
       function futureCheck(pr, n, p, grid){
        let g = grid.map((subArray) => {
  return subArray.map((subSubArray) => {
    return subSubArray.slice();
  });
});
        for(let i = 0; i < g.length; i++){
            for(let x = 0; x < g[0].length; x++){
                if(g[i][x][1] === pr){
                    g[i][x][2] = '';
                }
                if(g[i][x][1] === n){
                    g[i][x][2] = p;
                }
            }
           
        } 
        if(inCheck(p.charAt(0), g, true)){
            console.log("t");
                return true;
            }
          
      // console.log(chessGrid);
      // console.log(g);
        return false;
       }
       function getPiece(piece){
        let fullPiece = '';
        if(piece.substring(1) === 'p'){
            fullPiece = "pawn";
        }
        else if(piece.substring(1) === 'k'){
             fullPiece = "knight";
        }
        else if(piece.substring(1) === 'b'){
            fullPiece = "bishop";
        }
        else if(piece.substring(1) === 'r'){
            fullPiece = "rook";
        }
        else if(piece.substring(1) === 'ki'){
            fullPiece = "king";
        }
        if(piece.substring(1) === 'q'){
             fullPiece = "queen";
        }
        return fullPiece;
       }
     function deletePiece(id){
        for(let i = 0; i < chessGrid.length; i++){
                for(let x = 0; x < chessGrid[i].length; x++){
                    if(chessGrid[i][x][1] === id){
                        chessGrid[i][x][2] = '';
                        var child = document.getElementById(id).lastElementChild; 
                         while (child) {
                              document.getElementById(id).removeChild(child);
                              child =  document.getElementById(id).lastElementChild;
                            }
                    }
                }
            }
     }
    
       function makeMove(prevId, newId, piece){
        if(!castled){
        
        hlPrev(prevId, newId);
        
        let white = false;
        if(piece.charAt(0) === 'w'){
            white = true;
        }
        for(let i = 0; i < chessGrid.length; i++){
                for(let x = 0; x < chessGrid[i].length; x++){
                    if(chessGrid[i][x][1] === prevId){
                        chessGrid[i][x][2] = '';
                         var child = document.getElementById(prevId).lastElementChild; 
                         while (child) {
                              document.getElementById(prevId).removeChild(child);
                              child =  document.getElementById(prevId).lastElementChild;
                            }

                    }
                    else if(chessGrid[i][x][1] === newId){
                        chessGrid[i][x][2] = piece;
                        var child = document.getElementById(newId).lastElementChild; 
                         while (child) {
                              document.getElementById(newId).removeChild(child);
                              child =  document.getElementById(newId).lastElementChild;
                            }
                            var img = document.createElement("img");
                            if(white){ 
                                img.src =   piece + ".png";
                            }
                            else{
                                img.src =   piece + ".png";
                            }
                           
                            if(piece === 'bk' || piece === 'wk'){
                                img.classList.add("chess_knight"); 
                            } 
                            else if(piece === 'wp'){
                                img.classList.add("chess_pawn"); 
                            } 
                            else if(piece === 'bb'){
                                img.classList.add("chess_bishop"); 
                            } 
                            else{
                                img.classList.add("chess"); 
                            }
                                document.getElementById(newId).appendChild(img);
                    }
                }
            }
            if(piece === 'wp'){
            if(newId > -1 && newId < 8){
                promote(newId, "wq");
            }
            }
            else if(piece === 'bp'){
            if(newId < 64 && newId > 55){
                promote(newId, "bq");
            }
            }
            evaluatePosition();
            inCheck('w', chessGrid, false);
            inCheck('b', chessGrid, false);
            if(inCheck('w', chessGrid, false)){
              if(inCheckMate('w', chessGrid)){
                document.getElementById("w").textContent = 'Checkmate';
              }
              else{
                document.getElementById("w").textContent = 'Check';
              }
            }
            else{
                document.getElementById("w").textContent = '';
                wCheck = false;
            }
            if(inCheck('b', chessGrid)){
               if(inCheckMate('b', chessGrid)){
                document.getElementById("b").textContent = 'Checkmate';
               }
               else{
                document.getElementById("b").textContent = 'Check';
               }
            }
            else{
                document.getElementById("b").textContent = '';
                bCheck = false;
            }

        }
        else{
            castled = false;
        }
       }
       function inCheckMate(color, grid){
            let checkMate = true;
            if(color === 'w'){
               
                for(let i = 0; i < grid.length; i++){
                for(let x = 0; x < grid[i].length; x++){
                    if(grid[i][x][2] !== '' && grid[i][x][2].charAt(0) === 'w'){
                    for(let z = 0; z < grid.length; z++){
                        for(let y = 0; y < grid[z].length; y++){
                       
                            if(grid[i][x][1] !== grid[z][y][1]){
                            if(checkLegalMove(grid[i][x][1], grid[z][y][1], grid[i][x][2], grid, true, false) && !futureCheck(grid[i][x][1], grid[z][y][1], grid[i][x][2], grid)){
                                checkMate = false;
                                
                            }
                        }
                        }
                        }
                    }
                       
                    
                }
            }
           
            
        }
        else{
           
            for(let i = 0; i < grid.length; i++){
                for(let x = 0; x < grid[i].length; x++){
                    if(grid[i][x][2] !== '' && grid[i][x][2].charAt(0) === 'b'){
                    for(let z = 0; z < grid.length; z++){
                        for(let y = 0; y < grid[z].length; y++){
                           
                            if(grid[i][x][1] !== grid[z][y][1]){
                            if(checkLegalMove(grid[i][x][1], grid[z][y][1], grid[i][x][2], grid, true, false) && !futureCheck(grid[i][x][1], grid[z][y][1], grid[i][x][2], grid)){
                                checkMate = false;
                               
                            }
                        }
                           
                        
                    
                    }
                }
            }
                }
            }
            
           
            console.log(checkMate);
        }
        return checkMate;
        }
        
    function aichange(){
        var checkBox = document.getElementById("myCheck");
        if (checkBox.checked == true){
           
        } else {
         text.style.display = "none";
        }
    }
    function allLegalMoves(grid){
        for(let i = 0; i < grid.length; i++){
            for(let x = 0; x < grid[i].length; x++){
                if(grid[i][x][2] !== ''){
                    grid[i][x][3] = [];
                    for(let z = 0; z < grid.length; z++){
                         for(let y = 0; y < grid[z].length; y++){
                            if(checkLegalMove(grid[i][x][1], grid[z][y][1], grid[i][x][2], grid, false, false) && !futureCheck(grid[i][x][1], grid[z][y][1], grid[i][x][2], grid)){
                                grid[i][x][3].push(grid[z][y][1]);
                   }
                }
            }
        }
    }
}
console.log(chessGrid);
    }


    function makeRandomMove(color, grid){
        let done = false;
        let idArray = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63];
        while(!done){
            if(idArray.length === 0){
        return false;
    }
    let randIndex = Math.floor(Math.random() * idArray.length);
        let randId = idArray[randIndex];
        for(let i = 0; i < grid.length; i++){
        for(let x = 0; x < grid[i].length; x++){
            if(grid[i][x][1] === randId){
                if(grid[i][x][2].charAt(0) !== color || grid[i][x][2] === ''){
                    idArray.splice(randIndex, 1);
                }
                else{
                     if(grid[i][x][3].length !== 0){
                        let randPos = grid[i][x][3][Math.floor(Math.random() * grid[i][x][3].length)];
                        prevMove = [grid[i][x][1], randPos, grid[i][x][2], x];
                        makeMove(grid[i][x][1], randPos, grid[i][x][2]);
                        
                       // alert(prevMove);
                        done = true;
                        whiteTurn = !whiteTurn;
                     }
                     else{
                        idArray.splice(randIndex, 1);
                     }
                }
            }
        }
    }
   
}
    }
    function hlPrev(o, n){
       if(mo){
        for(let i = 0; i < chessGrid.length; i++){
        for(let x = 0; x < chessGrid[i].length; x++){
            if(chessGrid[i][x][1] === o){
                document.getElementById(chessGrid[i][x][1]).classList.add("box-prev");
                
            }
            else if(chessGrid[i][x][1] === n){
                document.getElementById(chessGrid[i][x][1]).classList.add("box-prev1");
            }
            else{
                document.getElementById(chessGrid[i][x][1]).classList.remove("box-prev");
                document.getElementById(chessGrid[i][x][1]).classList.remove("box-prev1");
            }
        }
    }
}
}
function promote(id, piece){
    for(let i = 0; i < chessGrid.length; i++){
        for(let x = 0; x < chessGrid[i].length; x++){
            if(chessGrid[i][x][1] === id){
                chessGrid[i][x][2] = piece;
                document.getElementById(id).removeChild(document.getElementById(id).firstChild);
                var img = document.createElement("img");
                img.src =   piece + ".png";
                img.classList.add("chess");
                document.getElementById(id).appendChild(img);
            }
        }
    }
}
    
function evaluatePosition(){
  let positionScore = 0;
  let piecePoints = countMaterial();
  positionScore = piecePoints.whiteValue - piecePoints.blackValue;
  console.log(positionScore);
    
}
function countMaterial(){
    let pawnValue = 1;
    let bishopValue = 3;
    let knightValue = 3;
    let rookValue = 5;
    let queenValue = 9;
    let whiteValue = 0;
    let blackValue = 0;
    for(let i = 0; i < chessGrid.length; i++){
        for(let x = 0; x < chessGrid[i].length; x++){
            let piece = chessGrid[i][x][2];
            if(piece === 'wp'){
                whiteValue += pawnValue;
            }
            else if(piece === 'wb'){
                whiteValue += bishopValue;
            }
            else if(piece === 'wk'){
                whiteValue += knightValue;
            }
            else if(piece === 'wr'){
                whiteValue += rookValue;
            }
            else if(piece === 'wq'){
                whiteValue += queenValue;
            }
            else if(piece === 'bp'){
                blackValue += pawnValue;
            }
            else if(piece === 'bb'){
                blackValue += bishopValue;
            }
            else if(piece === 'bk'){
                blackValue += knightValue;
            }
            else if(piece === 'br'){
                blackValue += rookValue;
            }
            else if(piece === 'bq'){
                blackValue += queenValue;
            }
        }
    }
    return {whiteValue, blackValue};
}

function Search(){
    let depth = 1;
   
    while(depth > 0){
       makeAllMoves('w', chessGrid);
      // makeAllMoves('b', chessGrid); 
       depth--;
    }
}
const timer = ms => new Promise(res => setTimeout(res, ms));
let depth = 1;
Search();

async function makeAllMoves(color, grid){

        for(let i = 0; i < grid.length; i++){
        for(let x = 0; x < grid[i].length; x++){
          if(grid[i][x][2].charAt(0) === color){
            for(let z = 0; z < grid[i][x][3].length; z++){
                let piece = grid[i][x][2];
                
                makeMove(grid[i][x][1], grid[i][x][3][z], grid[i][x][2]);
                 await timer(250);
                makeMove(grid[i][x][3][z], grid[i][x][1], piece);
              //  depth = 1;
                }
                
            }
          }
     }
     
    }
    
   

/*function makeRandomMove(color, grid){
    // let uidArray = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63];
     
    let madeMove = false;
    let idArray = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63];
 //   while(!madeMove){
     
    let randId = idArray[Math.floor(Math.random() * idArray.length)];
    let found = false;
    let piece = '';
    while(!found){
    for(let i = 0; i < grid.length; i++){
        for(let x = 0; x < grid[i].length; x++){
            if(grid[i][x][2].charAt(0) === color && grid[i][x][2] !== '' && grid[i][x][1] === randId){
                found = true;
                piece = grid[i][x][2];
               
                
            }
            else if(grid[i][x][1] === randId && (grid[i][x][2].charAt(0) !== color || grid[i][x][2] === '')){
                for(let z = 0; z < idArray.length; z++){
                    if(idArray[z] === randId){
                       
                            idArray.splice(z, 1);
                        
                    }
                }
                randId = idArray[Math.floor(Math.random() * idArray.length)];
            }
        }
    }
    }
    let newIdArray = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63];
    let newId = newIdArray[Math.floor(Math.random() * newIdArray.length)];
    let newFound = false;
    //alert(randId + piece);
    while(!newFound){
    for(let i = 0; i < grid.length; i++){
        for(let x = 0; x < grid[i].length; x++){
            if(grid[i][x][1] === newId){
                
                 // if(piece !== undefined){  
                alert(piece);
                if(checkLegalMove(randId, newId, piece, chessGrid, false)){
                    
                                newFound = true;
                                madeMove = true;
                                makeMove(randId, newId, piece);
                                whiteTurn = !whiteTurn;
                                break;
                                
                 }
                 else{
                    
                    for(let z = 0; z < newIdArray.length; z++){
                       // alert("n" + newId);
                       // alert(newIdArray[z]);
                      if(newIdArray[z] === newId){
                        
                      
                            newIdArray.splice(z, 1);
                           
                        
                       
                    }
                }
                
              // alert(newIdArray)
                
                 }
                 newId = newIdArray[Math.floor(Math.random() * newIdArray.length)];
            }
        }
            }
        }
        if(newIdArray.length === 0){
            newFound = true;
        }
    //}
    
//}
   // alert(randId);
} */
    /*function makeRandomMove(color, grid){
        let notDone = true;
    while(notDone){
        alert("2");
        let difColor = true;
        let randId = Math.floor(Math.random() * 64);
        let piece;
        while(difColor){
            for(let i = 0; i < grid.length; i++){
                for(let x = 0; x < grid[i].length; x++){
                    if(grid[i][x][1] === randId){
                        if(grid[i][x][2].charAt(0) === color){
                            piece = grid[i][x][2];
                            difColor = false;
                        }
                        else{
                            randId = Math.floor(Math.random() * 64);
                            break;
                        }
                    }
                }
            }
        }
        
        let idArray = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63];
        let notMove = true;
        let nextId = idArray[Math.floor(Math.random() * idArray.length)];
        
        while(notMove){
        for(let i = 0; i < grid.length; i++){
                for(let x = 0; x < grid[i].length; x++){
                    if(grid[i][x][1] === nextId){  
                               
                            if(grid[i][x][1] !== randId){
                               // alert("k");
                            if(checkLegalMove(randId, nextId, piece, grid, true)){
                               //alert("ok");
                                notMove = false;
                                notDone = false;

                                makeMove(randId, nextId, piece);
                                whiteTurn = !whiteTurn
                                break;
                                
                            }
                                else{
                                     
                                     for(let z = 0; z < idArray.length; z++){
                                        if(idArray[z] === nextId){
                                            if(z === 0){
                                                idArray.splice(0, 1);
                                            }
                                            else{
                                                idArray.splice(z, z);
                                            }
                                          
                                        }

                                     }

                                     nextId = idArray[Math.floor(Math.random() * idArray.length)];
                                     alert("n" + nextId);
                                     console.log(idArray);
                                }
                            
                        }
                        
                    }
                       
                    
                }
            }
            if(idArray.length === 0){
                alert("1");
                break;
                notMove = false;
            }
            if(idArray.length === 1){
                alert("at 1");
               
            }
        }
    }
} */
    
    </script>
    </body>
</html>
